name: Deploy info

# If there is a PR from a fork which has been approved to run GitHub Actions,
# this action will push the PR's head to a branch directly in the repo (not the fork),
# so it's deployed by Cloudflare Pages as a branch preview.

# NOTE: This workflow triggers the `deploy-info-run.yml` workflow.

on:
  workflow_dispatch:
    inputs:
      simulate_fork_pr:
        description: 'Simulate fork for this PR number'
  pull_request:
    branches: [ main ]

jobs:
  deploy-info:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    if: >
      inputs.simulate_fork_pr ||
      github.event.pull_request.head.repo.full_name != github.repository

    steps:
      - name: Save PR number
        run: |
          mkdir -p ./pr
          echo ${{ inputs.simulate_fork_pr || github.event.number }} > ./pr/pr_number

      - uses: actions/upload-artifact@v4
        with:
          name: pr_number
          path: pr/
